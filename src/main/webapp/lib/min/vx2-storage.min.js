/*! http://www.csii.com.cn/hercules/vx
* Copyright (c) 2012-2017 CSII
* @license vx - v2.0 
*/
"use strict";!function(a,b){"function"==typeof define&&define.amd?define(["vx"],b):"object"==typeof exports?(b(require("vx")),module.exports="vStorage"):b(a.vx)}(this,function(a){function b(a,b){var c;try{c=a[b]}catch(d){c=!1}if(c){var e="__"+Math.round(1e7*Math.random());try{a[b].setItem(e,e),a[b].removeItem(e,e)}catch(d){c=!1}}return c}function c(c){var d=b(window,c);return function(){var e="vStorage-";this.setKeyPrefix=function(a){if("string"!=typeof a)throw new TypeError("[vStorage] - "+c+"Provider.setKeyPrefix() expects a String.");e=a};var f=a.toJson,g=a.fromJson;this.setSerializer=function(a){if("function"!=typeof a)throw new TypeError("[vStorage] - "+c+"Provider.setSerializer expects a function.");f=a},this.setDeserializer=function(a){if("function"!=typeof a)throw new TypeError("[vStorage] - "+c+"Provider.setDeserializer expects a function.");g=a},this.supported=function(){return!!d},this.get=function(a){return d&&g(d.getItem(e+a))},this.set=function(a,b){return d&&d.setItem(e+a,f(b))},this.remove=function(a){d&&d.removeItem(e+a)},this.$get=["$rootScope","$window","$log","$timeout","$document",function(d,h,i,j,k){var l,m,n=e.length,o=b(h,c),p=o||(i.warn("This browser does not support Web Storage!"),{setItem:a.noop,getItem:a.noop,removeItem:a.noop}),q={$default:function(b){for(var c in b)a.isDefined(q[c])||(q[c]=a.copy(b[c]));return q.$sync(),q},$reset:function(a){for(var b in q)"$"===b[0]||delete q[b]&&p.removeItem(e+b);return q.$default(a)},$sync:function(){for(var a,b=0,c=p.length;c>b;b++)(a=p.key(b))&&e===a.slice(0,n)&&(q[a.slice(n)]=g(p.getItem(a)))},$apply:function(){var b;if(m=null,!a.equals(q,l)){b=a.copy(l),a.forEach(q,function(c,d){a.isDefined(c)&&"$"!==d[0]&&(p.setItem(e+d,f(c)),delete b[d])});for(var c in b)p.removeItem(e+c);l=a.copy(q)}},$supported:function(){return!!o}};return q.$sync(),l=a.copy(q),d.$watch(function(){m||(m=j(q.$apply,100,!1))}),h.addEventListener&&h.addEventListener("storage",function(b){if(b.key){var c=k[0];c.hasFocus&&c.hasFocus()||e!==b.key.slice(0,n)||(b.newValue?q[b.key.slice(n)]=g(b.newValue):delete q[b.key.slice(n)],l=a.copy(q),d.$apply())}}),h.addEventListener&&h.addEventListener("beforeunload",function(){q.$apply()}),q}]}}return a=a&&a.module?a:window.vx,a.module("vStorage",[]).provider("$localStorage",c("localStorage")).provider("$sessionStorage",c("sessionStorage"))}),function(a,b,c){var d=b.module("vStorage");d.provider("$submitConfig",{submitErrProcess:null,setSubmitErrProcess:function(a){this.submitErrProcess=a},submitCompileProcess:null,setSubmitCompileProcess:function(a){this.submitCompileProcess=a},submitBeforeProcess:null,setSubmitBeforeProcess:function(a){this.submitBeforeProcess=a},$get:["$log",function(a){var b=this;return{doSubmitErrProcess:function(a,c,d){b.submitErrProcess&&b.submitErrProcess(a,c,d)},doSubmitCompileProcess:function(a){b.submitCompileProcess&&b.submitCompileProcess(a)},doSubmitBeforeProcess:function(a){b.submitBeforeProcess&&b.submitBeforeProcess(a)}}}]}),d.directive("ngSubmit",["$parse","$rootScope","$submitConfig","$log",function(a,c,d,e){return{restrict:"A",compile:function(c,f){var g=a(f.ngSubmit,null,!0);return function(c,h){var i=h.controller("form");c[f.name].$getData=function(){function c(a){for(var b,c=[],d=0;d<a.length;d++)isValidItem(a[d])&&(b=copy(a[d]),c.push(b));return c}function d(b,c,d){var e=a(c+"=tmp");e(b,{tmp:d})}function e(a){return b.isUndefined(a)||""===a||null===a||a!==a}return function(a){var f={},g={};return a&&(g=parentForm.$getData()),b.forEach(i,function(a){if(a&&a.$name&&!a.$parentModel){var b=a.$modelValue;if(e(b))return;if(a.$virtual&&(b=c(b),0===b.length))return;d(f,a.$name,b)}}),b.extend({},g,f)}}(),d.doSubmitCompileProcess(c),h.on("submit",function(a){d.doSubmitBeforeProcess(c);for(var b=c[f.name],h=f.language||c.language||"zh_CN",i=f.$$element[0],j=0;j<i.length;j++){var k=i[j];-1!=="inputselect".indexOf(k.tagName.toLowerCase())&&k.blur();var l=k.getAttribute("validate")||!0;if("BUTTON"!==k.nodeName&&"false"!==l){var m={};m.zh_CN={required:k.getAttribute("required-message")||"不能为空",min:k.getAttribute("min-message")||"最小值:"+k.getAttribute("v-min"),max:k.getAttribute("max-message")||"最大值:"+k.getAttribute("v-max"),minlength:k.getAttribute("minlength-message")||"最小长度:"+k.getAttribute("v-minlength"),maxlength:k.getAttribute("maxlength-message")||"最大长度:"+k.getAttribute("v-maxlength"),pattern:k.getAttribute("pattern-message")||"格式不正确","default":"格式不正确"},m.en={required:k.getAttribute("required-message_en")||"required invalid",min:k.getAttribute("min-message_en")||"min value:"+k.getAttribute("v-min"),max:k.getAttribute("max-message_en")||"max value:"+k.getAttribute("v-max"),minlength:k.getAttribute("minlength-message_en")||"min length:"+k.getAttribute("v-minlength"),maxlength:k.getAttribute("maxlength-message_en")||"max length:"+k.getAttribute("v-maxlength"),pattern:k.getAttribute("pattern-message_en")||"pattern invalid","default":"pattern invalid"};var n=k.name||k.id,o="en"===h?"["+(k.getAttribute("title_en")||n)+"]  ":"["+(k.getAttribute("title_zh")||k.title||n)+"]  ";for(var p in b.$error)for(var q=0;q<b.$error[p].length;q++)if(n==b.$error[p][q].$name){var r="en"===h?p+"-message_en":p+"-message",s=m[h][p]||k.getAttribute(r)||m[h]["default"];return d.doSubmitErrProcess(o,s,c),void e.error(o+s)}}}var t=function(){g(c,{$event:a})};c.$apply(t)})}}}}])}(window,window.vx),function(a,b,c){var d=b.module("vStorage");d.provider("$contextConfig",{$sessionStorageEnable:!1,setSessionStorageEnable:function(a){this.$sessionStorageEnable=a},$get:["$log",function(a){var b=this;return{sessionStorageEnable:b.$sessionStorageEnable}}]}),d.factory("$context",["$rootScope","$location","$sessionStorage","$contextConfig",function(c,d,e,f){var g=function(){var a={};return e.$supported&&f.sessionStorageEnable?(e.$default({_dataSQueue:[]}),a.setData=function(a,b){e[a]=b,e.$apply()},a.setJson=function(a){for(var b in a)e[b]=a[b];e.$apply()},a.setNextScope=function(b){a._dataS=b},a.getData=function(a){return e[a]},a.removeData=function(a){delete e[a],e.$apply()},a.clear=function(){e.$reset()}):(a._dataSQueue=[],a.setData=function(b,c){a[b]=c},a.setJson=function(b){for(var c in b)a[c]=b[c]},a.setNextScope=function(b){a._dataS=b},a.getData=function(b){return a[b]},a.removeData=function(b){delete a[b]},a.clear=function(){for(var b in a)/^(_dataSQueue)|(setData)|(setJson)|(setNextScope)|(getData)|(removeData)|(clear)$]/.test(a[b])||delete a[b]}),a}();return c.$context=g,c.$on("$viewContentLoadedStart",function(c,d,h){var i=g._dataS;if(i&&"{}"!=b.toJson(i))try{var j=g.getData("_dataSQueue"),k=0;for(k;k<j.length;k++)if(j[k]==h){j.splice(k,1);break}j.push(h),j.length>f.sessionStorageEnable&&delete e[j.shift()],e._dataSQueue=j,e[h]=i,b.extend(d,i),e.$apply()}catch(l){a.history.back(-1)}finally{delete g._dataS}else if(h&&g.getData(h))try{b.extend(d,g.getData(h))}catch(l){a.history.back(-1)}}),g}])}(window,vx);